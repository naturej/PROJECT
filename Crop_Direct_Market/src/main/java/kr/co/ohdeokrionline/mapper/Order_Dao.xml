<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace=
	"kr.co.ohdeokrionline.model.dao.Order_Dao">
	
	<select id="sellermanage" resultType="kr.co.ohdeokrionline.model.vo.Order_DTO">
		select * from orderlist o join salboard s on o.bo_num=s.bo_num where SELL_USERID=#{user_id}
	</select>
	<update id="orderstatechange">
		update orderlist set or_state='확인' where or_id=#{order_num}
	</update>
	
	<!-- 주문 입력 -->
  	<insert id="insert" parameterType="kr.co.ohdeokrionline.model.vo.Board_DTO">
	      INSERT INTO ORDERLIST(OR_ID,BO_NUM,OR_QUAN,OR_DATE,BUY_USERID,OR_COST,SELL_USERID,OR_STATE,OR_HOW,ADD_CODE,OR_ADDD,OR_ADDR)
	      VALUES(#{or_id},#{bo_num},#{or_quan},SYSDATE,#{buy_userid},#{or_cost},#{sell_userid},'입금대기',#{or_how},#{add_code},#{or_addd},#{or_addr})   
	     </insert>
	     
<!-- 주문 번호 생성 -->	    
	<select id="orid" resultType="STRING">
	 SELECT to_date(SYSDATE,'YYYY-MM-DD')||'-'|| ROUND(DBMS_RANDOM.VALUE(100000, 999999),0) as OR_ID FROM DUAL
	</select>


<!-- 주문생성 후 장바구니 삭제 -->
	<delete id="delshopbag" parameterType="kr.co.ohdeokrionline.model.vo.ShoppingBasket_DTO">
	DELETE SHOPBAG WHERE USER_ID=#{user_id} AND BO_NUM=#{bo_num} AND SH_QUANTITY=#{sh_quantity}
	</delete>

<!-- 주문생성, 장바구니 삭제후 다시 장바구니 LIST 비동기 출력 -->
		<select id="shopbaglist" parameterType="STRING" resultType="kr.co.ohdeokrionline.model.vo.ShoppingBasket_DTO">
		SELECT S.BO_NUM AS BO_NUM,
			   S.BO_SUBJECT AS BO_SUBJECT,
			   S.BO_PHOTO AS BO_PHOTO,
			   S.BO_PRICE AS BO_PRICE,
			   S.USER_ID AS SELL_ID,
			   SH.USER_ID AS USER_ID, 
			   SH.SH_QUANTITY AS SH_QUANTITY, 
			   SH.SH_PRICE AS SH_PRICE
		FROM SALBOARD S 
		JOIN SHOPBAG SH
		ON S.BO_NUM = SH.BO_NUM
		WHERE s.USER_ID = #{user_id}
		</select>
	
	<!-- 주문list 출력 -->
	<select id="orderlist" resultType="kr.co.ohdeokrionline.model.vo.Order_DTO">
		  SELECT O.OR_ID AS OR_ID, 
          O.OR_DATE AS OR_DATE,
          S.BO_SUBJECT AS BO_SUBJECT,
          S.PRO_NAME AS PRO_NAME,
          O.OR_COST AS OR_COST,
          O.OR_QUAN AS OR_QUAN,
          O.SELL_USERID AS SELL_USERID,
          O.OR_STATE AS OR_STATE,
          O.OR_HOW AS OR_HOW
          FROM ORDERLIST O JOIN SALBOARD S on O.BO_NUM=S.BO_NUM where O.BUY_USERID=#{buy_userid}
          ORDER BY O.OR_DATE DESC
	</select>
	
</mapper>